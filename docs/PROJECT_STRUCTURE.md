# Project Structure and Architecture Overview

## Table of Contents

1. [High‑Level Overview](#high-level-overview)
2. [Top‑Level Directories](#top-level-directories)
3. [Configuration & Build Files](#configuration--build-files)
4. [Frontend (`src/`)](#frontend-src)
5. [Backend & Database (`supabase/`)](#backend--database-supabase)
6. [Documentation (`docs/`)](#documentation-docs)
7. [How the Pieces Fit Together](#how-the-pieces-fit-together)
8. [Development Workflow](#development-workflow)

---

### High‑Level Overview

`PedidosAI` is a **voice‑first order management web application** for Latin‑American restaurants. It consists of:

- **Frontend** built with **Next.js 16 (App Router)** and **Tailwind CSS 4** for a modern, responsive UI.
- **Backend** provided by **Supabase** (PostgreSQL, Auth, Storage, Edge Functions) which stores orders, suppliers, and user data.
- **AI services** – Groq Whisper for speech‑to‑text and Gemini 1.5 Flash for parsing and classification of orders.
- **Email integration** via Resend for notifications.

All components communicate through the Supabase client and custom edge functions, keeping the architecture server‑less and highly scalable.

---

## Top‑Level Directories

| Directory                                                                                         | Purpose                                                            |
| ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| `.agent/`                                                                                         | Workflow definitions (e.g., `code_review.md`).                     |
| `.gemini/`                                                                                        | Guideline files (`guidelines/INDEX.toon`, etc.).                   |
| `.git/`                                                                                           | Version control metadata.                                          |
| `.next/`                                                                                          | Build artefacts generated by Next.js.                              |
| `node_modules/`                                                                                   | NPM dependencies.                                                  |
| `src/`                                                                                            | **Frontend source code** – pages, components, hooks, utilities.    |
| `supabase/`                                                                                       | **Backend resources** – SQL migrations, Edge Functions, seed data. |
| `docs/`                                                                                           | Project documentation (e.g., `PROJECT_CONTEXT.toon`).              |
| `e2e/`                                                                                            | End‑to‑end test suite (Playwright).                                |
| Root config files (`package.json`, `tsconfig.json`, `tailwind.config.ts`, `next.config.ts`, etc.) | Build and tooling configuration.                                   |

---

## Configuration & Build Files

- **`package.json`** – Lists dependencies, scripts (`dev`, `build`, `lint`, etc.).
- **`pnpm-lock.yaml`** – Lockfile for reproducible installs.
- **`tsconfig.json`** – TypeScript compiler options.
- **`next.config.ts`** – Next.js configuration (typed routes, experimental server actions). Enables large request bodies (`bodySizeLimit: '25mb'`).
- **`tailwind.config.ts`** – Tailwind CSS customization (colors, typography, dark mode). Central to the premium UI aesthetic.
- **`postcss.config.mjs`** – PostCSS pipeline for Tailwind.
- **`.eslintrc` / `eslint.config.mjs`** – Linting rules.
- **`prettier` files** – Code formatting.

---

## Frontend (`src/`)

### App Router (`src/app/`)

- **`layout.tsx`** – Root layout, wraps the whole app with providers (Theme, Supabase session, etc.).
- **`page.tsx`** – Home page entry point.
- **`globals.css`** – Global CSS reset and Tailwind base imports.
- **`(auth)/`** – Authentication pages (sign‑in, sign‑up) using Supabase Auth.
- **`(protected)/`** – Routes that require an authenticated session (dashboard, orders).
- **`api/`** – Server‑side API routes (e.g., webhook handlers, custom endpoints).
- **`dashboard/`**, **`invite/`**, **`onboarding/`** – Feature‑specific pages.

### Components (`src/components/`)

- **`ui/`** – Re‑usable UI primitives (buttons, cards, modals) styled with Tailwind and custom design tokens.
- **`auth/`** – Login forms, social auth buttons.
- **`orders/`** – Order list, order detail, order review components.
- **`history/`** – Recent activity view.
- **`suppliers/`** – Supplier selection UI.
- **`theme-provider.tsx`** – Dark‑mode toggle and theme context.

### Context & Hooks (`src/context/`, `src/hooks/`)

- **`SupabaseProvider`** – Supplies Supabase client & session to the React tree.
- **Custom hooks** (`useOrders`, `useSupplier`, `useVoiceInput`) encapsulate data fetching, mutation, and voice‑first logic.

### Library (`src/lib/`)

Utility functions for:

- API request wrappers.
- Data transformation (e.g., converting voice transcripts to order objects).
- Validation helpers.

### Proxy (`src/proxy.ts`)

Acts as a thin server‑side proxy for external AI services, handling authentication tokens and request throttling.

---

## Backend & Database (`supabase/`)

- **`functions/`** – Supabase Edge Functions (TypeScript) that expose custom endpoints to the frontend. Typical functions:
  - `process-order.ts` – Receives parsed order data, creates `order` and `supplier_order` rows, triggers notifications.
  - `send-email.ts` – Uses Resend to email order confirmations.
- **`migrations/`** – SQL migration files that define the schema (tables: `orders`, `supplier_orders`, `users`, `suppliers`, etc.).
- **`seed/`** – Optional seed data for development (sample suppliers, menu items).
- **`supabase/config.ts`** – Supabase client initialization for server‑side code.

Supabase also provides **Auth**, **Realtime**, and **Storage** services used throughout the app.

---

## Documentation (`docs/`)

- **`PROJECT_CONTEXT.toon`** – Domain‑specific context for the project (business rules, voice commands).
- **`TOON_REFERENCE.md`** – Specification of the TOON format used for context files.
- **`AUTHENTICATION_IMPLEMENTATION_PLAN.md`** – Example implementation plan for a different feature.
- Future documentation such as this `PROJECT_STRUCTURE.md` will live here.

---

## How the Pieces Fit Together

1. **User Interaction** – The chef uses the web UI (Next.js) to start a voice order. The UI captures audio and sends it to **Groq Whisper** via the `proxy.ts` endpoint.
2. **Transcription** – Whisper returns a text transcript, which is sent to **Gemini 1.5 Flash** (also via `proxy.ts`) for intent parsing and supplier classification.
3. **Order Creation** – Parsed data is posted to a Supabase Edge Function (`process-order.ts`). This function writes rows to the PostgreSQL database (`orders`, `supplier_orders`).
4. **Realtime Updates** – Supabase Realtime pushes order status changes to the UI, allowing the chef to see live updates.
5. **Notifications** – When an order is finalized, `send-email.ts` uses **Resend** to email the supplier.
6. **Authentication** – Supabase Auth secures protected routes; the `SupabaseProvider` injects the session into React context.
7. **Styling & UX** – Tailwind CSS, custom design tokens, and micro‑animations provide the premium, dynamic look required by the project guidelines.

---

## Development Workflow

- **Planning** – Create a `task.md` and `implementation_plan.md` for each non‑trivial change.
- **Implementation** – Write code in `src/` or `supabase/` following guidelines in `.gemini/guidelines/`.
- **Verification** – Run `pnpm dev` for local dev, `pnpm test` for unit/e2e tests, and the `/code_review` workflow for linting and type‑checking.
- **Deployment** – Supabase Edge Functions are deployed with `supabase functions deploy`, and the Next.js app is deployed to Vercel.

---

_This document provides a comprehensive overview of the project's structure, key files, and the interaction between frontend, backend, and AI services._
